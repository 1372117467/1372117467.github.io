<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>极客电玩</title>
  <style>
    /* 全局平滑滚动过渡 */
    html {
      scroll-behavior: smooth;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: "Microsoft YaHei", sans-serif;
      background-color: #f2f3f5;
      color: #333;
    }
    header {
      position: fixed; top:0; left:0;
      width:100%; height:50px;
      background: linear-gradient(to right, #4b6cb7, #182848);
      color: white; line-height:50px;
      text-align:center; font-size:18px; font-weight:bold;
      z-index:999; box-shadow:0 2px 5px rgba(0,0,0,0.1);
    }
    #searchBox {
      position: fixed; top:50px; left:0;
      width:100%; height:40px;
      background:#fff; padding:0 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: flex; align-items: center; justify-content: center;
    }
    #searchBox input {
      width: 80%; height: 30px;
      padding: 5px; font-size: 16px;
      border: 1px solid #ddd; border-radius: 4px;
    }
    #sidebar {
      position: fixed; top:90px; left:0;
      width:100px; height:calc(100vh - 90px);
      background:#fff; border-right:1px solid #e0e0e0;
      padding-top:10px; overflow-y:auto;
    }
    #sidebar a {
      display:block; padding:10px;
      font-size:12px; color:#555; text-decoration:none;
      border-left:3px solid transparent;
      transition: all .3s;
    }
    #sidebar a:hover {
      background:#f0f0f0; border-color:#4b6cb7; color:#4b6cb7;
    }
    #content {
      margin-left:120px; padding:70px 20px 20px;
    }
    #orderPage {
      display: none; padding: 20px;
      background: #fff; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      border-radius: 6px;
    }
    .category {
      margin-bottom:20px; padding:16px;
      background:#fff; border-left:4px solid #4b6cb7;
      border-radius:6px; box-shadow:0 1px 3px rgba(0,0,0,0.05);
      transition: box-shadow .3s;
    }
    .category h2 {
      font-size:16px; color:#4b6cb7; margin-bottom:10px;
    }
    .game-item {
      background:#fafafa; padding:10px; margin:10px 0;
      border-radius:4px; border:1px solid #ddd;
    }
    .game-title { font-weight:600; font-size:15px; }
    .game-size { font-size:12px; color:#666; margin:6px 0; }
    .buttons {
      display:flex; align-items:center; gap:8px;
    }
    .buttons button {
      width:28px; height:28px; font-size:16px;
      background:#4b6cb7; color:#fff; border:none; border-radius:4px;
      cursor:pointer; transition: background .2s;
    }
    .buttons button:hover { background:#374e9b; }
    .buttons span {
      width:24px; text-align:center; font-size:14px;
    }
    #orderPage table {
      width:100%; border-collapse:collapse; margin-top:12px;
    }
    #orderPage th, #orderPage td {
      border:1px solid #ccc; padding:8px; text-align:center;
    }
    #orderPage th { background:#f0f0f0; }
    #orderPage button {
      margin:12px 6px; padding:8px 16px;
      background:#4b6cb7; color:#fff; border:none; border-radius:4px;
      cursor:pointer; transition: background .2s;
    }
    #orderPage button:hover { background:#374e9b; }
    .footer {
      position: fixed; bottom:0; left:0; width:100%;
      background:#fff; border-top:1px solid #e0e0e0;
      display:flex; justify-content:space-between; align-items:center;
      padding:10px 20px;
    }
    .footer button {
      background:#ff7043; color:#fff; border:none;
      padding:8px 16px; border-radius:4px; cursor:pointer;
      transition: background .2s;
    }
    .footer button:hover { background:#e65a31; }
    @media(max-width:600px) {
      #sidebar { width:80px; }
      #content { margin-left:90px; padding:70px 12px; }
      .footer { flex-direction:column; gap:10px; }
      .footer button { width:100%; }
    }
  </style>
</head>
<body>
<header>极客电玩</header>

<!-- 搜索框 -->
<div id="searchBox">
  <input type="text" id="searchInput" placeholder="搜索游戏..." oninput="filterGames()">
</div>

<div id="sidebar"></div>

<div id="content">
  <h1 style="text-align:center;">游戏订单管理</h1>
  <div id="gameCategories"></div>
  <div id="noSelectionMessage" style="display:none; text-align:center; margin-top:20px; color:red;">
    <p>请先选择游戏后才能生成订单！</p>
  </div>
</div>

<div id="orderPage">
  <h2>订单详情</h2>
  <table>
    <thead>
      <tr>
        <th>游戏名称</th>
        <th>数量</th>
        <th>单款容量 (GB)</th>
        <th>小计容量 (GB)</th>
      </tr>
    </thead>
    <tbody id="orderTableBody"></tbody>
    <tfoot>
      <tr>
        <td colspan="3" style="text-align:right;font-weight:600;">总容量：</td>
        <td id="orderTotal">0</td>
      </tr>
    </tfoot>
  </table>
  <div style="text-align:center; margin-top:16px;">
    <button onclick="backToShop()">返回继续选购</button>
    <button onclick="confirmOrder()">确认订单</button>
  </div>
</div>

<div class="footer">
  <span id="totalSize">总容量：0 GB</span>
  <button onclick="generateOrder()">生成订单</button>
</div>

<script>
  const gameData = {
    "动作冒险": [
      {code:"A1", name:"艾尔登法环", size:60},
      {code:"C1", name:"刺客信条4：黑旗", size:40},
      {code:"C2", name:"刺客信条：幻景", size:50}
    ],
    "角色扮演":[
      {code:"B1", name:"博德之门3", size:70},
      {code:"B2", name:"冰汽时代2", size:70}
    ],
    "策略游戏":[
      {code:"C7", name:"城市天际线2", size:40}
    ],
    "赛车游戏":[
      {code:"C8", name:"尘埃拉力赛2.0", size:25}
    ]
  };

  let selected = {}, total = 0;

  function displayCategories(filteredGames = null) {
    const cont = document.getElementById("gameCategories");
    cont.innerHTML = "";
    for (let cat in gameData) {
      const sec = document.createElement("div");
      sec.className = "category";
      sec.id = cat;
      sec.innerHTML = `<h2>${cat}</h2>`;
      const gamesToDisplay = filteredGames && filteredGames[cat] ? filteredGames[cat] : gameData[cat];
      gamesToDisplay.forEach(g => {
        const it = document.createElement("div");
        it.className = "game-item";
        it.innerHTML = `
          <div class="game-title">${g.name}</div>
          <div class="game-size">${g.size} GB</div>
          <div class="buttons">
            <button onclick="add('${g.code}',${g.size})">+</button>
            <span id="qty-${g.code}">0</span>
            <button onclick="remove('${g.code}',${g.size})">-</button>
          </div>`;
        sec.appendChild(it);
      });
      cont.appendChild(sec);
    }
  }

  function filterGames() {
    const query = document.getElementById("searchInput").value.toLowerCase();
    const filteredGames = {};
    
    for (let cat in gameData) {
      filteredGames[cat] = gameData[cat].filter(game => game.name.toLowerCase().includes(query));
    }

    displayCategories(filteredGames);
  }

  function generateSidebar() {
    const sb = document.getElementById("sidebar");
    sb.innerHTML = "";
    for (let cat in gameData) {
      const a = document.createElement("a");
      a.href = `#${cat}`;
      a.textContent = cat;
      sb.appendChild(a);
    }
  }

  function add(code, size) {
    if (!selected[code]) {
      selected[code] = 1;
      total += size;
      document.getElementById(`qty-${code}`).textContent = 1;
      updateTotal();
    }
  }

  function remove(code, size) {
    if (selected[code]) {
      selected[code] = 0;
      total -= size;
      document.getElementById(`qty-${code}`).textContent = 0;
      updateTotal();
    }
  }

  function updateTotal() {
    document.getElementById("totalSize").textContent = `总容量：${total} GB`;
  }

  function generateOrder() {
    if (Object.keys(selected).length === 0) {
      document.getElementById("noSelectionMessage").style.display = "block";
      return;
    }
    const orderTableBody = document.getElementById("orderTableBody");
    orderTableBody.innerHTML = "";
    let sum = 0;
    for (let cat in gameData) {
      gameData[cat].forEach(g => {
        if (selected[g.code]) {
          sum += g.size;
          orderTableBody.innerHTML += `
            <tr>
              <td>${g.name}</td>
              <td>1</td>
              <td>${g.size}</td>
              <td>${g.size}</td>
            </tr>`;
        }
      });
    }
    document.getElementById("orderTotal").textContent = sum;
    document.getElementById("content").style.display = "none";
    document.getElementById("sidebar").style.display = "none";
    document.querySelector(".footer").style.display = "none";
    document.getElementById("orderPage").style.display = "block";
  }

  function confirmOrder() {
    const codes = [];
    for (let cat in gameData) {
      gameData[cat].forEach(g => {
        if (selected[g.code]) codes.push(g.code);
      });
    }
    const codeStr = codes.join("/");
    // 切换订单详情表中名称为编号
    document.querySelectorAll("#orderTableBody tr").forEach((tr,i) => {
      tr.cells[0].textContent = codes[i];
    });
    // 复制
    const inp = document.createElement("input");
    inp.value = codeStr;
    document.body.appendChild(inp);
    inp.select();
    document.execCommand("copy");
    inp.remove();
    alert(`订单已确认并复制：${codeStr}`);
  }

  function backToShop() {
    document.getElementById("content").style.display = "block";
    document.getElementById("sidebar").style.display = "block";
    document.querySelector(".footer").style.display = "flex";
    document.getElementById("orderPage").style.display = "none";
    document.getElementById("noSelectionMessage").style.display = "none";
  }

  // 初始化
  displayCategories();
  generateSidebar();
</script>
</body>
</html>
